<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>About - Погода</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="mstyle.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Quicksand&amp;display=swap"
    />
    <link
      rel="shortcut icon"
      href="./assets/icons/favicon.svg"
      type="image/x-icon"
    />
    <script src="./js/icon.js" crossorigin="anonymous"></script>
  </head>
  <body>
    <header>
      <a href="https://www.voenmeh.ru/" class="logo">
        <i class="fal fa-sun fa-3x"></i>
        <h4>&nbsp;Погода</h4>
      </a>

      <div class="navMain">
        <button class="openbtn" onclick="openNav()">&#9776;</button>
      </div>

      <div class="nav">
        <div id="mySidepanel" class="sidebar">
          <a href="javascript:void(0)" class="closebtn" onclick="closeNav()"
            >&times;
          </a>
          <ul>
            <li>
              <a href="index.html">Главная</a>
              <a class="active" href="about.html">Информация</a>
            </li>
          </ul>
        </div>
      </div>
    </header>

    <div class="contain">
      <div class="intro">
        <p>
          #include <stdlib.h> <br />
#include <stdio.h>
#include <unistd.h>
#include <fcntl.h>
#include <signal.h>
#include <string.h>

void SIGUSR1_Handler(int signal);
void SIGTERM_Handler(int signal);
void CloseFile();

int currentFileSize = 0;
int fileDescriptor = -1;
int exitFlag = 0;
int fileClosedFlag = 0;

int main(int argc, char const *argv[])
{
    if (argc != 2)
    {
        printf("Wrong command line's arguments\n");
        return 1;
    }
    printf("\nStart of programm\n");

    struct sigaction act'
    sigset_t set;

    memset(&act,0,sizeof(act));
    act.sa_handler = SIGUSR1_Handler;
    sigemptyset(&set);
    sigaddset(&set, SIGUSR1);
    act.sa_mask = set;
    sigaction(SIGUSR1, &act, 0);

    memset(&act, 0, sizeof(act));
    act.sa_handler = SIGTERM_Handler;
    sigemptyset(&set);
    sigaddset(&set, SIGTERM);
    act.sa_mask = set;
    sigaction(SIGTERM, &act, 0);

    fileDescriptor = open("example", 0_RDWR | 0_CREAT | 0_TRUNC, 00600);
    if (fileDescriptor == -1)
    {
        printf("\nFile creation error\n");
        return 1;
    }
    else printf("\nFile was created successfilly\n");
    raise(SIGUSR1);
    printf("\nStart of filling file\n");

    int bytesQuantity = atoi(argv[1]);
    for (currentFileSize = 0; currentFileSize < bytesQuantity; currentFileSize++)
    {
        if(exitFlag)
            return 0;

        char randomValue = (char)(rang() % 256);
        if (write(fileDescriptor, (void*)(&randomValue), sizeof(randomValue)) == -1)
        {
            printf("\nFile writing error\n");
            CloseFile();
            return 1;
        }
    }

    printf("\nEnd of filling file\n");
    CloseFile();
    printf("\nEnd of programm\n");
    return 0;
}

void SIGUSR1_Handler(int signal)
{
    printf("\n Current file size is %d bytes\n", currentFileSize);
}

void SIGTERM_Handler(int signal)
{
    printf("\nProgramm has been interrupted by SIGTERM\n");
    CloseFile();
    if (unlink("example") == -1)
        printf("\nFile could'n be deleted\n");
    else
        printf("\nFile was deleted successfully\n");
    exitFlag = 1;
}

void CloseFile()
{
    if (fileClosedFlag)
        return;
    if (close(fileDescriptor) == -1)
    {
        printf("\nFile couldn't be closed\n");
        fileClosedFlag = 0;
    }
    else
    {
        printf("\nFile was closed Successfilly\n");
        fileClosedFlag = 1;
    }
}<br />
        </p>
        <a href="https://www.voenmeh.ru/" target="_blank">
          <i class="fab fa-github fa-2x"></i>
          <h2>&nbsp;Военмех</h2>
        </a>
      </div>
    </div>

    <footer class="footerA">
      <p>&#169; Работа по Практике Палёнова Александра И508Б</p>
    </footer>

    <div class="abgimg">
      <img src="assets/about.jpg" alt="weather-img" scroll="no" />
    </div>

    <script src="./js/nav.js"></script>
  </body>
</html>
