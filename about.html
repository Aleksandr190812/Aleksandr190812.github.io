<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>About - Погода</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="mstyle.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Quicksand&amp;display=swap"
    />
    <link
      rel="shortcut icon"
      href="./assets/icons/favicon.svg"
      type="image/x-icon"
    />
    <script src="./js/icon.js" crossorigin="anonymous"></script>
  </head>
  <body>
    <header>
      <a href="https://www.voenmeh.ru/" class="logo">
        <i class="fal fa-sun fa-3x"></i>
        <h4>&nbsp;Погода</h4>
      </a>

      <div class="navMain">
        <button class="openbtn" onclick="openNav()">&#9776;</button>
      </div>

      <div class="nav">
        <div id="mySidepanel" class="sidebar">
          <a href="javascript:void(0)" class="closebtn" onclick="closeNav()"
            >&times;
          </a>
          <ul>
            <li>
              <a href="index.html">Главная</a>
              <a class="active" href="about.html">Информация</a>
            </li>
          </ul>
        </div>
      </div>
    </header>

    <div class="contain">
      <div class="intro">
        <p>
          #include <stdlib.h> <br />
#include <stdio.h><br />
#include <stdlib.h><br />
#include <string.h><br />
#include <windows.h><br />
struct person<br />
{<br />
       char name[30];<br />
       char importer[30];<br />
       int volume;<br />
};<br />
<br />
void add (char*);   /* добавить запись в файл */<br />
void edit (char*);  /* редактировать запись */<br />
void show (char*);  /* просмотреть содержимое файла */<br />
void search1 (char*);    /* найти самого старшего работника среди мужчин */<br />
void search2 (char*);  /*вывести список молодых специалистов до 28 лет с высшим образованием*/<br />
void del (char*);       /* удалить запись из файла */<br />
void printing (FILE *, int);<br />
<br />
int main (int argc, char* argv[])<br />
{<br />
    SetConsoleCP(1251);<br />
	SetConsoleOutputCP(1251);<br />
    char filename[80]; /*определение имени файла*/<br />
    if (argc > 1)<br />
        strcpy (filename, argv[1]);<br />
    else<br />
    {<br />
        puts("Введите имя файла для обработки");<br />
        gets(filename);<br />
    }<br />
    int menu;<br />
    do<br />
    {<br />
       system ("CLS");<br />
       puts ("1. Добавление записи");<br />
       puts ("2. Редактирование записи");<br />
       puts ("3. Просмотр записей");<br />
       puts ("4. Удаление записи");<br />
       puts ("5. Вывод страны и объема по товару");<br />
       puts ("6. Выход");<br />
       scanf ("%d%*c", &menu);<br />
       switch (menu)<br />
       {
              case 1 : add (filename); break;
              case 2 : edit (filename); break;
              case 3 : show (filename); break;
              case 4 : del (filename); break;
              case 5 : search1 (filename); break;
       }
    }
    while (menu!=6);
    return 0;
}

/*заполнение одной записи (ввод данных о клиенте)*/
struct person input_client (void)
{
     struct person employee;
     int temp;
     puts ("Наименование");
     gets (employee.name);
     puts("Страна-импортер");
     gets( employee.importer);
     puts("Объем");
     scanf("%d", &temp);
     employee.volume = temp;
     getchar();
     return employee;
}

/* функция добавления записи в файл */
void add (char* file)
{
     FILE * f;
     struct person employee;
     system ("CLS");
     if ((f=fopen (file, "ab"))==NULL)
     {
          perror ("Ошибка открытия файла");
          getchar();
          return;
     }
     employee = input_client();
     fwrite (&employee, sizeof (employee), 1, f);
     fclose (f);
}

/* функция вывода на экран одной записи */
void print1 (struct person data)
{
    printf ("Наименование : %s\nСтрана-импортер : %s\nОбъем : %d",
            data.name, data.importer, data.volume);
}

/* функция редактирования записи */
void edit (char* file)
{
     FILE * f;
     struct person employee;
     char name[30],yes;
     system ("CLS");
     if ((f=fopen (file, "rb+"))==NULL)
     {
          perror ("Ошибка открытия файла"); getchar();
          return;
     }
     printf ("Наименование: "); gets (name);
     while (fread(&employee,sizeof(employee), 1, f))
        if (!strcmp(employee.name,name))
        {
             print1 (employee);
             puts ("\nРедактировать? (y/n)");
             do
             {
                  yes = getchar(); getchar();
             }
             while (yes!='y' && yes!='Y' && yes!='n' && yes!='N');
             if (yes=='y' || yes=='Y')
             {
                  employee = input_client();
                  fseek (f,-sizeof(employee),SEEK_CUR);
                  fwrite (&employee, sizeof (employee), 1, f);
                  fseek (f,0,SEEK_CUR);
             }
        }
     puts ("Поиск завершен"); getchar();
     fclose(f);
}

/* функция печати содержимого файла */
void show (char* file)
{
     FILE * f;
     int menu, menu2;
     struct person employee;
     int k=0;
     system ("CLS");
     if ((f=fopen (file, "rb"))==NULL)
     {
          perror ("Ошибка открытия файла");
          getchar();
          return;
     }
    puts ("|  N |             Наименование              |      Страна-Импортер      |   Объем   |");
    puts ("--------------------------------------------------------------------------------------");
    while(fread(&employee, sizeof(employee), 1, f)==1)
     {
                printf ("|%3d | %-37.30s |%-26s |%-8d   |\n",
                ++k, employee.name, employee.importer, employee.volume);
                puts ("--------------------------------------------------------------------------------------");
                }
    fclose(f);
    getchar(); getchar();
}


/* функция удаления записи из файла */
void del (char* file)
{

    FILE *f1, *f2;
    unsigned int n, n_file, i = 0;
    struct person employee;
    system ("CLS");
    if ((f1=fopen (file, "rb"))==NULL)
    {
        perror ("Ошибка открытия файла"); getchar();
        return;
    }
    fseek (f1, 0, SEEK_END);
    n_file = ftell(f1) / sizeof (employee);
    if (n_file == 0)
    {
        puts ("Файл пуст"); getchar();
        return;
    }
    puts ("Номер удаляемой записи?");
    scanf ("%u", &n);
    if ( n > n_file )
    {
        puts ("Некорректный номер");
        getchar();getchar();
        fclose (f1);
        return;
    }
    rewind (f1);
    if ((f2=fopen ("temp.dat", "wb"))==NULL)
    {
        perror ("Ошибка открытия файла");
        getchar();
        return;
    }
    while ( fread(&employee, sizeof(employee), 1, f1)==1 )
    {
        i++;
        if ( i != n )
            fwrite(&employee, sizeof(employee), 1, f2);
    }
    fclose (f1);
    fclose (f2);
    remove (file);
    rename ("temp.dat", file);
    puts ("Запись удалена");
    getchar();getchar();
}


/* функция поиска по товару */
void search1 (char* file)
{
     FILE * f;
     struct person employee, required;
     char req[30];
     int max_age = 3000, age;
     system ("CLS");
     if ((f=fopen (file, "rb"))==NULL)
     {
          perror ("Ошибка открытия файла"); getchar();
          return;
     }
     puts ("Введите искомый товар : ");
     gets(req);
     while (fread(&employee, sizeof(employee), 1, f)==1)
        if (!strcmp(employee.name,req))
        {
            printf("\n");
            print1 (employee);
            printf("\n");
        }
     fclose(f);
     getchar();getchar();
}
        </p>
        <a href="https://www.voenmeh.ru/" target="_blank">
          <i class="fab fa-github fa-2x"></i>
          <h2>&nbsp;Военмех</h2>
        </a>
      </div>
    </div>

    <footer class="footerA">
      <p>&#169; Работа по Практике Палёнова Александра И508Б</p>
    </footer>

    <div class="abgimg">
      <img src="assets/about.jpg" alt="weather-img" scroll="no" />
    </div>

    <script src="./js/nav.js"></script>
  </body>
</html>
